#!/usr/bin/env bash

###
echo "-----> Setup"
set -e
set -o pipefail

BUILD_DIR=$1
CACHE_DIR=$2
CROW_DIR=$BUILD_DIR/libs/crow


###
echo "-----> Installing Boost"
# apt-get update
# apt-get install libboost-all-dev
cd $CACHE_DIR

wget https://dl.bintray.com/boostorg/release/1.73.0/source/boost_1_73_0.tar.gz
tar xzvf boost_1_73_0.tar.gz
cd boost_1_73_0/

# apt-get update
# apt-get install build-essential g++ python-dev autotools-dev libicu-dev build-essential libbz2-dev libboost-all-dev

./bootstrap.sh --prefix=/usr/

./b2

./b2 install



###
echo "-----> Building Crow"

cd $CROW_DIR
mkdir build
cd build
cmake ..
make


###
echo "-----> Compiling app"

cd $CACHE_DIR

clang++-6.0 \
-std=c++17 \
$BUILD_DIR/src/main.cpp \
-Wall \
-lboost \
-L$CROW_DIR/build \
-I$BUILD_DIR/src \
-I$CROW_DIR/include \
-o $BUILD_DIR/main \
-v \

